<p-toast></p-toast>
<p-confirmDialog [style]="{ width: '450px' }" />

<div *ngIf="!!myStore?.id" class="grid grid-nogutter">
  <div class="col-12 flex justify-content-between">
    <div class="flex">
      <button
        pButton
        pRipple
        label="New"
        icon="pi pi-plus"
        class="p-button-success mr-2"
        (click)="onCreateItemBtnClick()"
      ></button>
      <button
        pButton
        pRipple
        label="Renew Expired Date"
        icon="pi pi-clock"
        class="p-button-warning mr-2"
        (click)="onRenewExpDateItemBtnClick()"
        [disabled]="!selectedItems || !selectedItems.length"
      ></button>
      <button
        pButton
        pRipple
        label="Publish"
        icon="pi pi-flag-fill"
        class="p-button-warning mr-2"
        (click)="onPublishItemBtnClick(true)"
        [disabled]="!selectedItems || !selectedItems.length"
      ></button>
      <button
        pButton
        pRipple
        label="Unpublish"
        icon="pi pi-flag"
        class="p-button-warning mr-2"
        (click)="onPublishItemBtnClick(false)"
        [disabled]="!selectedItems || !selectedItems.length"
      ></button>
    </div>
    <div class="flex">
      <button
        pButton
        pRipple
        label="Delete"
        icon="pi pi-trash"
        class="p-button-danger"
        (click)="onDeleteSelectedItemsClick()"
        [disabled]="!selectedItems || !selectedItems.length"
      ></button>
    </div>
  </div>
  <div class="col-12">
    <p-table
      dataKey="id"
      styleClass="p-datatable-sm"
      [value]="myProductItems"
      [loading]="isLoading"
      [(selection)]="selectedItems"
    >
      <ng-template pTemplate="header">
        <tr>
          <th class="flex justify-content-center" style="width: 4rem">
            <p-tableHeaderCheckbox />
          </th>
          <th></th>
          <th>Zeny</th>
          <th>Baht</th>
          <th>Quantity</th>
          <th>Published</th>
          <th>Expired</th>
          <th width="90px"></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td class="flex justify-content-center">
            <p-tableCheckbox [value]="product" />
          </td>
          <td>
            <div class="flex flex-wrap">
              <div class="flex align-items-center">
                <img src="assets/demo/images/items/{{ product.itemId }}.png" alt="" class="item_img h-fit" />
                <span class="mr-1" [hidden]="product.refine == 0">{{ '+' + product.refine }}</span>
                <span>{{ product.name }}</span>
              </div>
              <div class="flex align-items-center ml-2" *ngFor="let enchant of product.enchantInfos">
                <img src="assets/demo/images/items/{{ enchant.id }}.png" alt="" class="item_img h-fit" />
                <div>{{ enchant.name }}</div>
              </div>
            </div>
          </td>
          <td>{{ product.zeny | number }}</td>
          <td>{{ product.baht | number }}</td>
          <td>{{ product.quantity | number }}</td>
          <td>{{ product.isPublished }}</td>
          <td>{{ product.expDate | date : 'YYYY-mm-dd HH:MM' }}</td>
          <td>
            <button
              pButton
              pRipple
              icon="pi pi-pencil"
              class="mr-2 p-button-rounded p-button-outlined p-button-success"
              (click)="onEditItemClick(product)"
            ></button>
            <button
              pButton
              pRipple
              class="p-button-rounded p-button-outlined p-button-danger"
              icon="pi pi-trash"
              (click)="onDeleteProductClick(product)"
            ></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td>Not found</td>
        </tr>
      </ng-template>
    </p-table>
    <p-paginator
      (onPageChange)="pageChange($event)"
      [first]="firstRecord"
      [rows]="pageLimit"
      [totalRecords]="totalRecord"
      [rowsPerPageOptions]="pageOptions"
    ></p-paginator>
  </div>
</div>

<div *ngIf="!myStore?.id" class="grid grid-nogutter">
  <div class="col-12 flex">
    <button
      pButton
      pRipple
      label="Create Store"
      icon="pi pi-plus"
      class="p-button-success mr-2"
      (click)="onCreateStoreBtnClick()"
    ></button>
  </div>
</div>

<app-item-detail-dialog
  [(showDialog)]="showItemManagementDialog"
  (saveItemChange)="onSaveItemChange($event)"
  [itemMap]="itemMap"
  [itemDetail]="itemModel"
></app-item-detail-dialog>

<app-store-detail-dialog
  [(showDialog)]="showStoreDialog"
  [store]="myStore"
  (storeModelChange)="onSaveStoreChange($event)"
></app-store-detail-dialog>
